Bài viết này hướng dẫn cách sử dụng CloudEndure để dịch chuyển một máy ảo đang chạy ứng dụng ShareNote và hệ cơ sở dữ liệu MySQL đến một máy ảo EC2.

Chúng ta sẽ sử dụng máy ảo chạy ứng dụng ShareNote ở bài viết trước (TODO: Link) để làm máy nguồn. Máy nguồn có thể là máy ảo chạy Linux hoặc Windows.

	1. Tạo AWS Credential cho CloudEndure
	
	a. Tạo IAM Policy cho CloudEndure
	
	Bước 1: Từ AWS Console, chọn dịch vụ IAM. 
	
	Bước 2: Ở menu bên trái của IAM Console, chọn Policies.
	
	Bước 3: Ở trang Polices, chọn Create Policy.
	
	Bước 4: Ở trang tạo Policy, chọn tab JSON.
	
	Bước 5: Sao chép đoạn JSON từ trang sau CloudEndure IAM Policy 
	
	Bước 6: Trên IAM Console, xoá tất cả nội dung đang hiện thị trên trình soạn thảo, sau đó dán đoạn JSON ở bước trước vào. 
	
	Bước 7: Chọn Review policy.
	
	Bước 8: Ở ô Name, đặt tên cho policy là AWS-CloudEndure. Ở ô Description, điền Sample AWS-CloudEndure policy. 
	
	Bước 9: Chọn Create policy.
	
	b. Tạo IAM User và Credential cho CloudEndure

	Bước 1: Ở menu bên trái của IAM Console, chọn Users. 
	
	Bước 2: Ở trang Users, chọn Add user.
	
	Bước 3: Ở trang tạo User:
	Ở ô User name, điền AWS-CloudEndure.
	Ở phần Access type, chọn Programmatic access.
	
	Bước 4: Chọn Next: Permissions.
	
	Bước 5: Chọn Attach existing policies directly.
	
	Bước 6: Ở ô Search, điền AWS-CloudEndure, sau đó chọn policy AWS-CloudEndure bằng cách nhấn vào ô vuông bên cạnh.
	
	Bước 7: Chọn Next: Tags.
	
	Bước 8: Chọn Next: Review.
	
	Bước 9: Chọn Create User. 
	
	Bước 10: Chọn Download .csv. Lưu trữ file tải về ở vị trí an toàn, ta sẽ sử dụng file này ở các bước sau. 
	
	Bước 11: Chọn Close. 

	2. Cấu hình CloudEndure

	a. Tạo dự án và cấu hình AWS Credential trên CloudEndure Console
	
	Bước 1: Tạo tài khoản CloudEndure ở đây. 
	Lưu ý: Nếu bạn đã có tài khoản CloudEndure, có thể bỏ qua bước này.
	
	Bước 2: Đăng nhập vào CloudEndure Console.
	
	Bước 3: Từ CloudEndure Console, nhấn nút Create new project (biểu tượng dấu cộng) ở góc trên bên trái.
	
	Bước 4: Ở ô Project name, đặt tên cho dự án là Migrate ShareNote. Sau đó chọn CREATE PROJECT.
	
	Bước 5: Ở cửa sổ pop-up Project Not Set Up! hiện lên, chọn CONTINUE.
	Lưu ý: Nếu không có cửa sổ pop-up nào hiện lên, đảm bảo rằng dự án đang chọn là Migrate ShareNote (góc trên bên trái). Sau đó từ menu bên trái, chọn Setup & Info.
	
	Bước 6: Chọn Tab AWS CREDENTIALS.
	
	Bước 7: Điền AWS Access Key ID và AWS Secret Access Key từ file CSV tải xuống ở phần 1: Tạo AWS Credential cho CloudEndure.
	
	Bước 8: Chọn SAVE.

	b. Cấu hình Replication Settings
	
	Bước 1: Sau khi hoàn thành việc cấu hình AWS Credential, CloudEndure Console sẽ tự động chuyển sang Tab REPLICATION SETTINGS.
	Lưu ý: Bạn cũng có thể truy cập vào Tab REPLICATION SETTINGS bằng cách chọn Setup & Info từ menu bên trái, sau đó chọn Tab REPLICATION SETTINGS. 
	
	Bước 2: Ở ô Migration Source, chọn Other Infrastructure.
	
	Bước 3: Ở ô Migration Target, chọn AWS Asia Pacific (Singapore).
	
	Bước 4: Ở ô Choose the Replication Server instance type, chọn t3.medium.
	
	Bước 5: Ở ô Choose the Converter instance type, chọn t3.medium.
	
	Bước 6: Chọn SAVE REPLICATION SETTINGS.
	
	Bước 7: Ở cửa sổ pop-up Project setup complete, chọn SHOW ME HOW để chuyển đến trang hướng dẫn cài đặt CloudEndure Agent trên máy nguồn.

	3. Cài đặt Agents lên máy nguồn

	Bước 1: Sau khi hoàn thành việc cấu hình Replication Settings, CloudEndure Console sẽ tự động chuyển sang trang hướng dẫn cài đặt CloudEndure Agent lên máy nguồn.
	Lưu ý: Bạn cũng có thể truy cập vào trang này bằng cách chọn Machines từ menu bên trái.
	
	Bước 2: Kết nối vào máy nguồn bằng SSH (Linux) hoặc Remote Desktop (Windows).
	
	Bước 3: Cài đặt CloudEndure Agent trên máy nguồn bằng hướng dẫn ở bước 1. Thực hiện đúng hướng dẫn theo hệ điều hành của máy nguồn (Linux hoặc Windows).
	
	Bước 4: Sau khi hoàn thành cài đặt CloudEndure Agent, từ CloudEndure Console, chọn tab Machine, máy nguồn sẽ được hiển thị ở đây kèm với quá trình dịch chuyển dữ liệu.

	4. Cấu hình Blueprint cho máy mục tiêu 
	Blueprint là đặc tả cho máy mục tiêu trên môi trường AWS, bao gồm loại máy (VD: t3.medium), subnet, private ip, loại ổ đĩa EBS. 
Lưu ý: Có thể thực hiện Blueprint trong lúc đợi CloudEndure dịch chuyển dữ liệu từ máy nguồn.
	
	Bước 1: Từ Tab Machines của CloudEndure Console, bấm vào tên của máy nguồn.
Lưu ý: Không phải chọn vào ô vuông bên cạnh máy nguồn.
	
	Bước 2: Ở Tab BLUEPRINT, ô Machine Type, chọn t3.medium.
	
	Bước 3: Chọn SAVE BLUEPRINT.
	
	Bước 4: Ở cửa sổ pop-up Security Warning hiện lên, chọn OK.

	5. Thực hiện Cutover
	Lưu ý: Đợi CloudEndure hoàn thành việc dịch chuyển dữ liệu trước khi thực hiện Cutover, việc này có thể mấy vài phút. Khi hoàn thành việc dịch chuyển dữ liệu, trạng thái của máy nguồn sẽ chuyển thành Continous Data Replication.
	
	Bước 1: Từ Tab Machines của CloudEndure Console, nhấn vào ô vuông bên cạnh để chọn máy nguồn, sau đó chọn LUANCH 1 TARGET MACHINE, rồi chọn Cutover Mode. 
	
	Bước 2: Ở cửa sổ pop-up hiện lên, chọn CONTINUE. 
	CloudEndure sẽ thực hiện đồng bộ dữ liệu lần cuối cùng, sau đó thực hiện việc tạo máy ảo trên môi trường AWS. Để theo dõi quá trình Cutover, chọn Job Progress từ menu bên trái của CloudEndure Console.
	Đợi đến khi quá trình Cutover kết thúc trước khi chuyển sang bước tiếp theo.

	6. Cấu hình Security Group để truy cập ứng dụng ShareNote trên máy mục tiêu
	
	Bước 1: Từ AWS Console, chọn dịch vụ EC2. Ở Menu bên trái, chọn Instances.
	
	Bước 2: Chọn máy ảo với tên trùng với máy nguồn trên CloudEndure Console. Ghi chú lại Public DNS của máy ảo này trong tab Networking. 
	
	Bước 3: Chọn Tab Security, phần Security Groups, nhấn vào id của Security Group được tạo tự động cho máy ảo này. 
	
	Bước 4: Ở Tab Inbound Rules, chọn Edit inbound rules. 
	
	Bước 5: Chọn Add rule. 
	Ở ô Type, chọn Custom TCP.
	Ở ô Port Range đi, điền 8080.
	Ở ô Source, chọn Anywhere.
	
	Bước 6: Chọn Save rules.
	
	Bước 7: Dùng trình duyệt để truy cập ứng dụng ShareNote theo địa chỉ http://<public-dns>:8080
	Lưu ý: Thay <public-dns> bằng Public DNS của máy ảo được ghi chú lại ở bước 2.
